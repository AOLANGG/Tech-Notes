##  编译和链接

**`翻译环境：预编译+编译+汇编+链接`**

### 翻译环境

翻译环境是由**编译**和**链接**两个大的过程组成的，而**编译**又可以分解成：预处理，编译，汇编三个过程

![img](https://i-blog.csdnimg.cn/direct/a0f9b3a0ee8b4fe99ae2bcdb33d3a72d.png)

一个C语言的项目中可能有多个`.c`文件一起构建，那么多个`.c`文件如何生成可执行程序呢？

- 多个`.c`文件单独经过编译器，编译处理生成对应的目标文件
- 注：在windows环境下的目标文件的后缀是`.obj`·，Linux下的目标文件的后缀是`.o`
- 多个目标文件和链接库在一起经过连接器处理生成最终的可执行程序
- 链接库是指运行时库（支持程序运行的基本函数的集合）或者第三方库

把编译展开成三个过程

![img](https://i-blog.csdnimg.cn/direct/b02e2e3c60e34316b6fe5a12144f1255.png)

#### 预处理

在预处理阶段，源文件和头文件会被处理成`.i`为后缀的文件

在`gcc`环境下，对`test.c`文件预处理后的`.i`文件，命令如下

```
gcc -E test.c -o test.i
```

预处理阶段主要处理那些源文件中#开始的预编译指令

- 将所有的`#define`删除，并展开所有的宏定义
- 处理所有的条件编译指令，如`#if、#ifdef、#elif、#else、#endif`
- 处理#include预编译指定，把包含的头文件的内存插入到预编译指令的位置。这个过程是地柜进行的，也就是会被包含的头文件也可能包含其他文件
- 删除所有的注释
- 添加行号和文件名表示，方便后续编译器生成调试信息等
- 保留所有的`#pragma`编译器指令，编译器后续会使用

#### 编译

编译过程就是将预处理后的文件进行一系列的：**词法分析，语法分析，语义分析及优化**，生成响应的汇编代码文件

```
gcc -S test.i -o test.s
```

#### 汇编

汇编器就是将汇编代码转变成机器可执行的指令，每个汇编语句几乎都对应一条机器指令。

```
gcc -c test.s -o test.0
```

#### 链接

链接是一个复杂的过程，链接的时候需要把一堆文件链接在一起才生成可执行程序

链接过程主要包括：地址和空间分配，符号决议和重定位等这些步骤。

**链接**解决的是一个项目中多文件、多模块之间互相调用的问题
