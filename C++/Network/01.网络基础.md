## OSI七层模型

- **OSI**七层网络模型成为开放式系统参考模型，是一个逻辑上的定义和规范
- 把网络从逻辑上分为了7层，每层都有相关，相对应的物理设备，比如路由器、交换机
- OSI 七层模型是一种框架性的设计方法，其最主要的功能使就是帮助不同类型
  的主机实现数据传输;
- 它的最大优点是将服务、接口和协议这三个概念明确地区分开来，概念清楚，
  理论也比较完整. 通过七个层次化的结构模型使不同的系统不同的网络之间实现可靠的通讯;
- 但是, 它既复杂又不使用，常用的是TCP/IP四层模型

![img](https://i-blog.csdnimg.cn/direct/5914ff3e91ff4c63aae4bcff51e4e9cd.png)

## TCP/IP五层（四层）模型

TCP/IP 是一组协议的代名词，它还包括许多协议，组成了TCP/IP 协议簇.

TCP/IP 通讯协议采用了5 层的层级结构，每一层都呼叫它的下一层所提供的网络来完成自己的需求.

- **物理层**: 负责光/电信号的传递方式. 比如现在以太网通用的网线(双绞 线)、早

  期以太网采用的的同轴电缆(现在主要用于有线电视)、光纤, 现在的 wifi 无线网使用电磁波等都属于物理层的概念。物理层的能力决定了最大传输速率、传输距离、抗干扰性等. 集线器(Hub)工作在物理层.

- **数据链路层**: 负责设备之间的数据帧的传送和识别. 例如网卡设备的驱动、帧同

  步(就是说从网线上检测到什么信号算作新帧的开始)、冲突检测(如果检测到冲突就自动重发)、数据差错校验等工作. 有以太网、令牌环网, 无线 LAN 等标准. 交换机(Switch)工作在数据链路层

- **网络层**: 负责地址管理和路由选择. 例如在 IP 协议中, 通过 IP 地址来标识一台

  主机, 并通过路由表的方式规划出两台主机之间的数据传输的线路(路由). 路由器

  (Router)工作在网路层

- **传输层**: 负责两台主机之间的数据传输. 如传输控制协议 (TCP), 能够确保数据

  可靠的从源主机发送到目标主机

- **应用层**: 负责应用程序间沟通，如简单电子邮件传输（SMTP）、文件传输协

  议（FTP）、网络远程访问协议（Telnet）等

![img](https://i-blog.csdnimg.cn/direct/91f1156587ff4e0a903b86c519fbeccc.png)

对于上述对TCP/IP各个层次作用的解释的一些名词做出解释

- 端口：端口是一个用于标志一台主机运行某个程序的整数
- 数据分段：将较大的数据包拆分成更小的数据段的过程
- 数据帧：数据帧（Data Frame）是在计算机网络中用于数据传输的基本单位，组成部分有：
  - **帧头**：包含了控制信息，如目标地址、源地址、数据帧类型或长度等。通俗一点讲就是它的作用就是找到目标主机和目标主机如何正确接收这些数据的方法。
  - **数据部分**：实际传输的数据
  - **帧尾**：包含校验等错误检测信息，用于**检查数据在传输过程中是否损坏**。
- 路由：路由是指数据根据特定算法确定到目的地址的传输路径的一个过程，简单来说们，就是选择合适路径的过程。

一般而言

- 对于一台主机，它的操作系统内核实现了从传输层到物理层的内容
- 对于一台路由器，他实现了从网络层到物理层
- 对于一台交换机，它实现了从数据链路层到物理层
- 对于集线器，它实现 了物理层 

## 为什么要有TCP/IP协议

- 首先，即便是单机，你的计算机内部，其实都是存在协议的，比如：其他设备和内存通信，会有内存协议。其他设备和磁盘通信，会有磁盘相关的协议，比如：SATA，IDE，SCSI 等。只不过我们感知不到罢了。而且这些协议都在本地主机各自的硬件中，通信的成本、问题比较少
- 其次，网络通信最大的特点就是主机之间变远了。任何通信特征的变化，一定会带来新的问题，有问题就得解决问题，所以需要新的协议咯。
- 所以，为什么要有 TCP/IP 协议？本质就是通信主机距离变远了

## 什么是TCP/IP协议

- TCP/IP协议的本质是一种解决方案
- TCP/IP协议能分层，前提是因为问题本身可以分层

![img](https://i-blog.csdnimg.cn/direct/34a6e34d6bc34138af3ff8fc5f468959.png)

主机B 能识别data，并且准确提取a=10，b=20，c=30 吗？

答案是肯定的！因为双方都有同样的结构体类型struct protocol。也就是说，
用同样的代码实现协议，用同样的自定义数据类型，天然就具有”共识“，能够识别
对方发来的数据，这不就是约定吗

**所谓协议，就是通信双方都认识的结构化的数据类型**

因为协议栈是分层的，所以，每层都有双方都有协议，同层之间，互相可以认识对
方的协议

## 网络传输的基本流程

### 网络传输流程图

两台计算机设备通过TCP/IP协议通信的过程如下：

- 局域网通信

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/715dbb4e50e94a1cbd53180ca54fcd20.png)

- 跨网络通信

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/e45914654f88448da9627ad5b178776e.png)

### 数据包封装和分用

- 数据包在不同的协议层有不同的名字，在传输层叫数据段，在网络层叫数据报，在数据链路层叫数据帧
- 发送数据的时候，从应用层开始往下，每依次经过一层协议就要在数据首都加上一段数据，这个过程称为封装。
- 接收数据时，数据从物理层开始往上，每依次经过一层协议就要剥掉响应的首部数据，这个过程称为解包
- 解包时，根据首部中的 “上层协议字段” 将数据交给对应的上层协议处理.比如在网络层解包后发现该数据使用的是TCP协议，那么在向上传递数据时就会选择TCP协议而不是UDP。这个过程也被称为分用
- 对于每一层来说，上一层的传递的数据部分都被称为**有效载荷**，本层加的数据首部称为**报头**，所以**报文=报头+有效载荷**。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d6fe240375564ea9ad9d80c87ad220d2.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d92e04d98883494fa17f28ae70a9fa2f.png)

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/c19918e3d7ff4422a2f856a414d093d2.png)

## 网络中的地址管理

### IP地址

IP地址是在网络层用IP协议标识和定位设备的逻辑地址，其中IP协议分为IPv4和IPv6。IPv4下的IP地址是一个4字节，32位的无符号整数表示，通常写成四个十进制数字，每个数字占一个字节，数据范围是[0-255]。IPv6下的IP地址是16字节，采用八组十六进制数字，每组都是16位，即两个字节。

- 唯一标识一台网络上的设备。
- IP地址帮助路由器决定数据包如何从源地址传输到目标地址。
- 路由器根据目标IP地址将数据包从一个网络传输到另一个网络

### MAC地址

Mac地址是用于在数据链路层标识和定位设备的物理地址，由48位二进制表示，通常用十六进制的表示，被厂商预先分配给网卡。

- 每个网卡都有唯一的Mac地址，用于在局域网中唯一标识设备。
- 在局域网中，数据帧的源地址和目标地址是MAC地址，通过MAC地址确保数据帧能够准确地从发送端传输到接收端。

### 比较IP地址和Mac地址

IP地址可以在[不同的](https://so.csdn.net/so/search?q=不同的&spm=1001.2101.3001.7020)网络中标识唯一设备，帮助路由器将数据包**从一个网络到另一个网络**。Mac地址用于定位**网络内部**的目标设备。这俩各种再网络传输过程中起到了不可替代的作用。

简单来说，**IP地址告诉路由器数据应该转发给哪一个网络，Mac地址告诉路由器数据应该发给这个网络的那一台主机**。

![img](https://i-blog.csdnimg.cn/direct/761304b7b4374dd48bdc069747943b87.png)